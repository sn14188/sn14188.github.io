---
title: "inode"
date: 2025-11-05
---

이전에 pnpm이 `node_modules`를 만들 때 파일을 복사하지 않고 하드/심볼릭 링크로 연결하는 구조에 대해 다룬 적이 있습니다.
그 내용을 파고들다 보니, 결국 파일시스템 레벨의 이해가 필요하다는 생각이 들었습니다.<br>
이번 포스트에서는 그 핵심 개념인 아이노드를 살펴보면서, 하드 링크에 대해 좀 더 깊이 이해해보려 합니다.
<br><br>

## 아이노드

유닉스 계열의 파일시스템에서 파일이나 디렉터리의 정보를 저장하는 자료 구조를 말합니다. 파일마다 하나의 아이노드가 있으며, 각 아이노드는 고유한 아이노드 번호를 가지고 있습니다.<br>
아이노드는 단순히 설명을 위한 개념이 아니라 실제로 디스크에 저장되는 메타데이터 구조체로, 파일의 속성과 위치 정보를 담고 있습니다.

### 파일시스템

물리적인 디스크의 파티션 내에서 데이터를 클러스터 단위로 배치하고 관리하는 체계입니다. 일반적으로 디렉터리 구조를 가진 계층형 파일시스템이 사용됩니다.

| MS-DOS / Windows                               | Unix / Linux / macOS                                                                                        |
| ---------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| • FAT: FAT12, FAT16, FAT32<br>• NTFS<br>• ReFS | • minix<br>• GFS<br>• EXT: ext2, ext3, ext4<br>• Btrfs<br>• F2FS<br>• ZFS<br>• XFS<br>• HFS, HFS+<br>• APFS |

이렇게 다양하게 파일시스템이 존재합니다. 그런데 왜 굳이 아이노드를 알아야 할까요?<br>
대부분의 현대 파일시스템은 아이노드 또는 그와 동등한 개념의 메타데이터 오브젝트로 동작하기 때문입니다.
이름이나 구현 방식은 다르지만, "파일의 속성과 저장 위치를 별도의 구조로 관리한다"는 아이노드 모델은 거의 모든 시스템에 공통적으로 쓰입니다.

### 아이노드 구성

아이노드는 파일이나 디렉터리의 메타데이터와 저장 위치 정보를 담습니다. 이를 통해 파일이 어디에 있고 어떤 상태인지를 표현하며, 파일시스템은 이 정보를 바탕으로 실제 데이터를 찾고 권한이나 소유자 같은 속성을 관리합니다.<br>

- 메타데이터: 파일의 크기, 종류, 권한, 소유자, 타임스탬프 등
- 데이터 위치 정보: 파일 내용이 실제로 저장된 디스크 블록의 주소 목록

참고로 파일 이름은 아이노드에 저장되지 않습니다. 이름은 디렉터리의 데이터에 기록되어 아이노드 번호와 연결됩니다.

### 디렉터리

아이노드 리스트입니다. 내부의 데이터는 디렉터리 엔트리들의 목록이며, 각 엔트리는 이름과 아이노드 번호 쌍으로 구성됩니다.<br>
`.`(자기 자신), `..`(부모) 엔트리는 항상 포함되어있으며, 경로를 해석할 때 OS는 이 목록을 따라가며 최종 아이노드에 도달합니다.<br>

- 엔트리: 리스트를 구성하는 개별 기록 하나하나를 말합니다

중요한 것은 진짜 파일의 아이덴티티는 아이노드 번호라는 것입니다. 이름은 그저 디렉터리 안에서 아이노드를 찾기 위한 문자열일 뿐이며 OS는 파일을 다룰 때 "이름"을 직접 쓰지 않습니다.<br>
이해를 위해 임시로 만든 디렉터리의 내부를 살펴보겠습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % ls
a.txt	b.txt	c.txt	temp
(base) aidenseo@Aidens-MacBook-Pro temp % ls -a
.	..	a.txt	b.txt	c.txt	temp
(base) aidenseo@Aidens-MacBook-Pro temp % ls -ai1
95899141 .
  256034 ..
95905659 a.txt
95905715 b.txt
95905762 c.txt
95899297 temp
(base) aidenseo@Aidens-MacBook-Pro temp %
```

이 디렉터리의 바깥에서 메타데이터를 살펴보겠습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro Desktop % stat -x temp
  File: "temp"
  Size: 192          FileType: Directory
  Mode: (0755/drwxr-xr-x)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95899141    Links: 6
Access: Thu Nov  6 02:59:20 2025
Modify: Thu Nov  6 02:59:19 2025
Change: Thu Nov  6 02:59:19 2025
 Birth: Thu Nov  6 01:46:16 2025
(base) aidenseo@Aidens-MacBook-Pro Desktop %

```

### 파일

일반 파일의 아이노드는 데이터 블록의 위치 정보를 가지고 있으며, 그 블록들에는 실제 파일 내용이 저장됩니다.<br>
이름을 바꾸거나 하드 링크를 추가했을 때 아이노드 번호는 그대로지만, 파일을 복사하면 새로운 아이노드가 생성됩니다.<br>
먼저 위에서 만들었던 `a.txt`의 메타데이터를 살펴보겠습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % stat a.txt
16777231 95905659 -rw-r--r-- 1 aidenseo staff 0 10 "Nov  6 02:59:09 2025" "Nov  6 02:59:08 2025" "Nov  6 02:59:08 2025" "Nov  6 01:46:38 2025" 4096 8 0x40 a.txt
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x a.txt
  File: "a.txt"
  Size: 10           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95905659    Links: 1
Access: Thu Nov  6 02:59:09 2025
Modify: Thu Nov  6 02:59:08 2025
Change: Thu Nov  6 02:59:08 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp %
```

- `File: "a.txt"`: 파일 이름은 아이노드에 직접 저장되지 않고, 디렉터리 엔트리에서 관리됩니다
- `Inode: 95905659`: 아이노드 번호는 파일의 고유 식별자이며 같은 아이노드를 가리키는 하드 링크는 이 번호가 동일합니다
- `Links: 1`: 이 아이노드를 가리키는 디렉터리 엔트리의 개수이며, 하드 링크를 포함합니다
- `Access`, `Modify`, `Change`, `Birth`: 타임스탬프입니다

## 파일의 크기 vs. 디렉터리의 크기

위의 예시에서, `a.txt`, `b.txt`, `c.txt`는 모두 파일 크기가 10바이트로 같으며 같은 이름으로 추가한 디렉터리 `temp`는 빈 디렉터리입니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x temp
  File: "temp"
  Size: 64           FileType: Directory
  Mode: (0755/drwxr-xr-x)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95899297    Links: 2
Access: Thu Nov  6 01:47:58 2025
Modify: Thu Nov  6 01:47:58 2025
Change: Thu Nov  6 01:47:58 2025
 Birth: Thu Nov  6 01:47:58 2025
(base) aidenseo@Aidens-MacBook-Pro temp %
```

용량을 살펴보니 64바이트로, 4개 요소들을 합쳐도 고작 94바이트밖에 되지 않는데 상위 디렉터리인 `temp`는 192바이트나 됩니다. 이유가 무엇일까요?

### 디렉터리의 크기는 파일 크기의 합이 아니다

아이노드 모델을 가져와 생각해보면 이해가 됩니다. 디렉터리의 데이터는 디렉터리 엔트리들의 목록일 뿐이었으므로, 엔트리 목록이 차지하는 공간이지 각각의 파일 크기와는 무관할 것입니다.<br>
`a.txt`에 텍스트를 추가해 용량을 늘려 살펴보겠습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x a.txt
  File: "a.txt"
  Size: 2379         FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95915149    Links: 1
Access: Thu Nov  6 04:58:34 2025
Modify: Thu Nov  6 04:58:32 2025
Change: Thu Nov  6 04:58:32 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp % cd ..
(base) aidenseo@Aidens-MacBook-Pro Desktop % stat -x temp
  File: "temp"
  Size: 192          FileType: Directory
  Mode: (0755/drwxr-xr-x)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95899141    Links: 6
Access: Thu Nov  6 04:58:32 2025
Modify: Thu Nov  6 04:58:32 2025
Change: Thu Nov  6 04:58:32 2025
 Birth: Thu Nov  6 01:46:16 2025
(base) aidenseo@Aidens-MacBook-Pro Desktop %
```

`a.txt`의 크기가 2379바이트가 된 시점에도 이 파일을 포함하는 디렉터리의 크기는 변하지 않았음을 알 수 있습니다.<br>

### 하드 링크를 만들면 디렉터리의 크기도 커진다

하드 링크를 만든다면 디렉터리 엔트리가 차지하는 공간도 더 필요할 것이므로 `temp`의 크기가 커질 것으로 예상했습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % ln a.txt d.txt
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x a.txt
  File: "a.txt"
  Size: 10           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95915800    Links: 2
Access: Thu Nov  6 05:09:25 2025
Modify: Thu Nov  6 05:02:01 2025
Change: Thu Nov  6 05:09:24 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x d.txt
  File: "d.txt"
  Size: 10           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95915800    Links: 2
Access: Thu Nov  6 05:09:25 2025
Modify: Thu Nov  6 05:02:01 2025
Change: Thu Nov  6 05:09:24 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp % cd ..
(base) aidenseo@Aidens-MacBook-Pro Desktop % stat -x temp
  File: "temp"
  Size: 224          FileType: Directory
  Mode: (0755/drwxr-xr-x)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95899141    Links: 7
Access: Thu Nov  6 05:09:24 2025
Modify: Thu Nov  6 05:09:24 2025
Change: Thu Nov  6 05:09:24 2025
 Birth: Thu Nov  6 01:46:16 2025
(base) aidenseo@Aidens-MacBook-Pro Desktop %
```

### 파일을 복사하면 디렉터리의 크기도 커진다

```bash
(base) aidenseo@Aidens-MacBook-Pro temp % ls
a-copy.txt	a.txt		b.txt		c.txt		temp
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x a.txt
  File: "a.txt"
  Size: 10           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95915800    Links: 1
Access: Thu Nov  6 05:09:25 2025
Modify: Thu Nov  6 05:02:01 2025
Change: Thu Nov  6 05:11:10 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp % stat -x a-copy.txt
  File: "a-copy.txt"
  Size: 10           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95917281    Links: 1
Access: Thu Nov  6 05:12:45 2025
Modify: Thu Nov  6 05:02:01 2025
Change: Thu Nov  6 05:12:43 2025
 Birth: Thu Nov  6 01:46:38 2025
(base) aidenseo@Aidens-MacBook-Pro temp % cd ..
(base) aidenseo@Aidens-MacBook-Pro Desktop % stat -x temp
  File: "temp"
  Size: 224          FileType: Directory
  Mode: (0755/drwxr-xr-x)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 95899141    Links: 7
Access: Thu Nov  6 05:12:43 2025
Modify: Thu Nov  6 05:12:43 2025
Change: Thu Nov  6 05:12:43 2025
 Birth: Thu Nov  6 01:46:16 2025
(base) aidenseo@Aidens-MacBook-Pro Desktop %
```

## pnpm에 적용해 살펴보기

이를 pnpm을 사용한 프로젝트에 적용해본다면, 아이노드가 같은 하드 링크들을 확인할 수 있을 것입니다. 시험삼아 `node_modules/.pnpm`의 `@eslint`를 테스트해보기로 했고, 파일의 정보는 다음과 같았습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro FE % stat -x ~/FE/node_modules/.pnpm/@eslint+eslintrc@3.3.1/node_modules/@eslint/eslintrc/package.json
  File: "/Users/aidenseo/Desktop/FE/node_modules/.pnpm/@eslint+eslintrc@3.3.1/node_modules/@eslint/eslintrc/package.json"
  Size: 2391         FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 91263653    Links: 1
Access: Wed Oct  1 00:01:19 2025
Modify: Fri Sep 26 13:41:05 2025
Change: Wed Oct  1 01:13:52 2025
 Birth: Fri Sep 26 13:41:05 2025
(base) aidenseo@Aidens-MacBook-Pro FE %
```

그리고 pnpm 스토어 내부를 직접 살펴보니, 파일들이 모두 해시 형태로 저장돼있어 일반적인 방법으로는 어느 파일이 대응되는지 바로 비교하기가 어려웠습니다.<br>
AI의 도움을 받아 대응되는 파일을 찾아낸 결과는 다음과 같습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro 90 % stat -x ~/Library/pnpm/store/v10/files/90/05f2e5*

  File: "/Users/aidenseo/Library/pnpm/store/v10/files/90/05f2e584216a20cda6a66e573abdcb0a63d7252352b9ebf97bad660cbb0a42428d561587e66a1829c462b5cbeffb29ef727dc9731e42dc907afb2608443f0b"
  Size: 2391         FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/aidenseo)  Gid: (   20/   staff)
Device: 1,15   Inode: 90618314    Links: 1
Access: Wed Oct  1 00:01:19 2025
Modify: Fri Sep 26 13:41:05 2025
Change: Fri Sep 26 13:41:05 2025
 Birth: Fri Sep 26 13:41:05 2025
```

하지만 예상과 달리, 두 파일의 아이노드 번호는 달랐습니다.<br>
앞선 예에서 `a.txt`의 내용을 수정하고 저장했을 때 아이노드 번호가 바뀌는 현상을 본 적이 있었습니다.<br>
관련 검색을 통해 macOS의 APFS 파일시스템은 동일한 데이터 블록을 공유하는 클론 파일을 생성하며, 하드 링크와는 달리 각 파일은 서로 다른 아이노드를 가진다는 사실을 알게 되었습니다.<br>
파일 내용이 같은지 비교하는 커맨드로 확인해보겠습니다.

```bash
(base) aidenseo@Aidens-MacBook-Pro ~ % cmp -l \
/Users/aidenseo/Desktop/FE/node_modules/.pnpm/@eslint+eslintrc@3.3.1/node_modules/@eslint/eslintrc/package.json \
/Users/aidenseo/Library/pnpm/store/v10/files/90/05f2e584216a20cda6a66e573abdcb0a63d7252352b9ebf97bad660cbb0a42428d561587e66a1829c462b5cbeffb29ef727dc9731e42dc907afb2608443f0b

(base) aidenseo@Aidens-MacBook-Pro ~ %
```

출력되는 내용이 없다는 건 파일 내용이 완전히 같다는 뜻입니다.<br>
pnpm 공식 문서를 다시 살펴보니 별도 설정이 없으면 클론으로 세팅되는 것 같습니다. 하드 링크를 원했다면 `pnpm install --package-import-method=hardlink` 커맨드를 사용했어야 합니다.<br>
APFS의 클론 방식은 하드링크와 비슷한 속도를 유지하면서도, 수정 시 파일이 분리되어 원본이 오염되지 않아 더 안전하다고 합니다.<br>
<br>
눈에 보이는 "같은 파일" 구조를 직접 확인하지는 못했지만,
우선 pnpm이 이러한 시스템 특성을 활용하는 효율적인 패키지 매니저라는 점으로 마무리하고 또 아이노드에 대해 조금 더 이해하게 된 것으로 만족하려 합니다.<br>
[다음 포스트](https://sn14188.github.io/hard-linked-pnpm)에서는 실제로 하드 링크 옵션을 강제로 지정한 pnpm을 살펴보며 전역 스토어와 프로젝트 파일이 정말 같은 아이노드를 공유하는지 알아보겠습니다.

## Takeaways

1. 아이노드는 파일의 실제 정체성을 나타내는 메타데이터 구조로, 파일 이름과는 별개로 존재합니다
2. pnpm 같은 패키지 매니저는 하드 링크 또는 클론 구조를 이용해 `node_modules`의 용량을 줄이고, 설치 속도도 높일 수 있습니다
   <br><br>

_출처:<br>
[1] Wikipedia (["Inode"](https://en.wikipedia.org/wiki/Inode))<br>
[2] pnpm 공식 문서 (["Settings (.npmrc)"](https://pnpm.io/9.x/npmrc))<br>
[3] 이것이 취업을 위한 컴퓨터 과학이다, 강민철 저, 한빛미디어, 2024, p.233-234<br>_
